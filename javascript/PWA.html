<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PWA | Weitanai</title>
    <meta name="description" content="Rock And Roll">
    
    
    <link rel="preload" href="/assets/css/0.styles.5c38130e.css" as="style"><link rel="preload" href="/assets/js/app.4ed34284.js" as="script"><link rel="preload" href="/assets/js/2.179fc952.js" as="script"><link rel="preload" href="/assets/js/32.f57554e0.js" as="script"><link rel="prefetch" href="/assets/js/10.68dc8d53.js"><link rel="prefetch" href="/assets/js/11.832d96e7.js"><link rel="prefetch" href="/assets/js/12.33575e22.js"><link rel="prefetch" href="/assets/js/13.a044b60e.js"><link rel="prefetch" href="/assets/js/14.593fea9c.js"><link rel="prefetch" href="/assets/js/15.cad1522e.js"><link rel="prefetch" href="/assets/js/16.712b690b.js"><link rel="prefetch" href="/assets/js/17.cd78bb73.js"><link rel="prefetch" href="/assets/js/18.2debaf5f.js"><link rel="prefetch" href="/assets/js/19.f8de78ef.js"><link rel="prefetch" href="/assets/js/20.f0007b06.js"><link rel="prefetch" href="/assets/js/21.bfea6e70.js"><link rel="prefetch" href="/assets/js/22.d5f0398a.js"><link rel="prefetch" href="/assets/js/23.2ee85c93.js"><link rel="prefetch" href="/assets/js/24.d7b9c088.js"><link rel="prefetch" href="/assets/js/25.c0eecd02.js"><link rel="prefetch" href="/assets/js/26.f8eee9c5.js"><link rel="prefetch" href="/assets/js/27.b1ce073b.js"><link rel="prefetch" href="/assets/js/28.48df8e62.js"><link rel="prefetch" href="/assets/js/29.2f438cb0.js"><link rel="prefetch" href="/assets/js/3.8f4629bf.js"><link rel="prefetch" href="/assets/js/30.ec20a26d.js"><link rel="prefetch" href="/assets/js/31.ed3582c1.js"><link rel="prefetch" href="/assets/js/33.acdf3adf.js"><link rel="prefetch" href="/assets/js/34.fb00c414.js"><link rel="prefetch" href="/assets/js/35.e54e13a0.js"><link rel="prefetch" href="/assets/js/36.cab101c8.js"><link rel="prefetch" href="/assets/js/37.5bce502a.js"><link rel="prefetch" href="/assets/js/38.1f71117c.js"><link rel="prefetch" href="/assets/js/39.9322f78e.js"><link rel="prefetch" href="/assets/js/4.b253f392.js"><link rel="prefetch" href="/assets/js/40.a5a5bd97.js"><link rel="prefetch" href="/assets/js/5.b6a9313e.js"><link rel="prefetch" href="/assets/js/6.9ee5c745.js"><link rel="prefetch" href="/assets/js/7.2358918f.js"><link rel="prefetch" href="/assets/js/8.c2b664f0.js"><link rel="prefetch" href="/assets/js/9.56c8ec88.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5c38130e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Weitanai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端世界" class="dropdown-title"><span class="title">前端世界</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link router-link-active">工程实践</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/weitanai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端世界" class="dropdown-title"><span class="title">前端世界</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link router-link-active">工程实践</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/weitanai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/javascript/" class="sidebar-link">javascript的趋势</a></li><li><a href="/javascript/函数式编程.html" class="sidebar-link">函数式编程</a></li><li><a href="/javascript/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/javascript/CICD.html" class="sidebar-link">CI/CD</a></li><li><a href="/javascript/PWA.html" class="active sidebar-link">PWA</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javascript/Docker.html" class="sidebar-link">Docker</a></li><li><a href="/javascript/Regular.html" class="sidebar-link">regular expression</a></li><li><a href="/javascript/中间件.html" class="sidebar-link">可复用中间件</a></li><li><a href="/javascript/发布与部署.html" class="sidebar-link">发布和部署 (阿里云)</a></li><li><a href="/javascript/注册登录鉴权.html" class="sidebar-link">注册，登录与鉴权</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pwa"><a href="#pwa" class="header-anchor">#</a> PWA</h1> <h4 id="渐进式-web-应用会在桌面和移动设备上提供可安装的、仿应用的体验，可直接通过-web-进行构建和交付。它们是快速、可靠的-web-应用。最重要的是，它们是适用于任何浏览器的-web-应用"><a href="#渐进式-web-应用会在桌面和移动设备上提供可安装的、仿应用的体验，可直接通过-web-进行构建和交付。它们是快速、可靠的-web-应用。最重要的是，它们是适用于任何浏览器的-web-应用" class="header-anchor">#</a> 渐进式 Web 应用会在桌面和移动设备上提供可安装的、仿应用的体验，可直接通过 Web 进行构建和交付。它们是快速、可靠的 Web 应用。最重要的是，它们是适用于任何浏览器的 Web 应用</h4> <h4 id="快速-可靠"><a href="#快速-可靠" class="header-anchor">#</a> 快速 &amp; 可靠</h4> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <h4 id="手机-桌面"><a href="#手机-桌面" class="header-anchor">#</a> 手机&amp;桌面</h4> <h3 id="_1-主要架构"><a href="#_1-主要架构" class="header-anchor">#</a> 1 主要架构</h3> <h4 id="_1-web应用清单-manifest"><a href="#_1-web应用清单-manifest" class="header-anchor">#</a> 1 web应用清单 (manifest)</h4> <ul><li>告诉浏览器你希望本应用在独立窗口中打开（ <code>display</code> ）。</li> <li>定义首次启动本应用时要打开哪个页面（ <code>start_url</code> ）。</li> <li>定义应用在 Dock 或应用启动器上应该是什么样子（ <code>short_name</code> ，<code>icons</code> ）。</li> <li>创建一个闪屏（ <code>name</code> ， <code>icons</code> ， <code>colors</code> ）。</li> <li>告诉浏览器以横向或纵向模式打开窗口（ <code>orientation</code> ）。</li> <li>以及<a href="https://developer.mozilla.org/en-US/docs/Web/Manifest#Members" target="_blank" rel="noopener noreferrer">很多其它配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</li></ul> <h4 id="_2-提供基本的离线体验-service-worker"><a href="#_2-提供基本的离线体验-service-worker" class="header-anchor">#</a> 2 提供基本的离线体验  service worker</h4> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1569769252874-d4ac1661-1528-4ce0-8f40-f4f79331aebb.png" alt="swoker.png"></p> <ul><li>1 注册Service Worker</li> <li>2 Precache 离线页面</li> <li>3 清理旧的离线页面</li> <li>4 处理失败的网络请求</li></ul> <h3 id="_2-service-worker生命周期"><a href="#_2-service-worker生命周期" class="header-anchor">#</a> 2 Service Worker生命周期</h3> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1569769476478-7d0fea40-2993-4be3-bcf5-c1094734834e.png" alt="lifecycle.png"></p> <h4 id="install-事件"><a href="#install-事件" class="header-anchor">#</a> <code>install</code> 事件</h4> <p>Service Worker 获得的第一个事件是 <code>install</code> 。它会在 Service Worker 执行时立即触发，并且每个 Service Worker 只会调用一次。<strong>如果你更改了 Service Worker 脚本，浏览器就会将其视为另一个 Service Worker</strong>，并且它将获得自己的 <code>install</code> 事件。</p> <h4 id="activate-事件"><a href="#activate-事件" class="header-anchor">#</a> <code>activate</code> 事件</h4> <p>Service Worker 每次启动时都会收到 <code>activate</code> 事件。 <code>activate</code> 事件的主要目的是配置 Service Worker 的行为，清除以前运行中遗留的任何资源（例如旧缓存），并让 Service Worker 准备好处理网络请求（例如下面要讲的 <code>fetch</code> 事件）。</p> <h4 id="fetch-事件"><a href="#fetch-事件" class="header-anchor">#</a> <code>fetch</code> 事件</h4> <p>fetch 事件允许 Service Worker 拦截并处理任何网络请求。它可以通过网络获取资源、可以从自己的缓存中提取资源、生成自定义响应，以及很多种不同的选择。查看<a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/" target="_blank" rel="noopener noreferrer">离线宝典<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>了解你可以使用的不同策略。</p> <h4 id="更新-service-worker"><a href="#更新-service-worker" class="header-anchor">#</a> 更新 Service Worker</h4> <p>浏览器会检查每个页面加载时是否有新版本的 Service Worker 。如果找到新版本，则会下载这个新版本并在后台安装，但不会激活它。它会处于等待状态，直到不再打开任何使用旧 Service Worker 的页面。一旦关闭了使用旧 Service Worker 的所有窗口，新的 Service Worker 就会被激活并获得控制权。更多详细信息，请参阅 Service Worker 生命周期文档中的<a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#updates" target="_blank" rel="noopener noreferrer">更新 Service Worker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分。</p> <h3 id="_3-选择正确的缓存策略"><a href="#_3-选择正确的缓存策略" class="header-anchor">#</a> 3 选择正确的缓存策略</h3> <h4 id="缓存静态资源"><a href="#缓存静态资源" class="header-anchor">#</a> 缓存静态资源</h4> <p>预先缓存资源与用户安装桌面或移动应用时的情况类似。应用运行所需的关键资源已安装或缓存在设备上，以后无论是否有网络连接都可以加载它们。</p> <p>对于这个应用，我们将在安装 Service Worker 时预先缓存所有静态资源，以便把我们运行应用所需的一切都存储在用户的设备上。为了确保我们的应用快速加载，我们将使用<a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network" target="_blank" rel="noopener noreferrer">缓存优先<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>策略：不去网络获取资源，而是从本地缓存中取出；只有当缓存不可用时，我们才会尝试从网络中获取它。</p> <h4 id=""><a href="#" class="header-anchor">#</a> <img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1569769687799-a5a6336b-7dc5-4324-a87c-6f55252730e4.png" alt="static.png"></h4> <h4 id="缓存应用数据"><a href="#缓存应用数据" class="header-anchor">#</a> 缓存应用数据</h4> <p><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#stale-while-revalidate" target="_blank" rel="noopener noreferrer">stale-while-revalidate strategy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对某些类型的数据是理想的，比如本应用。它会尽可能快地获取屏幕上要显示的数据，然后在网络返回最新数据后进行更新。 Stale-while-revalidate 意味着我们需要发起两个异步请求，一个到缓存，一个到网络。</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1569769739853-e9b921d8-141a-478b-b30e-97128ad8db0b.png" alt="data.png"></p> <h3 id="_4-service-workers详解"><a href="#_4-service-workers详解" class="header-anchor">#</a> 4  service workers详解</h3> <ol><li>service worker URL 通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerContainer/register" target="_blank" rel="noopener noreferrer"><code>serviceWorkerContainer.register()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来获取和注册。</li> <li>如果注册成功，service worker 就在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope" target="_blank" rel="noopener noreferrer"><code>ServiceWorkerGlobalScope</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 环境中运行； 这是一个特殊类型的 woker 上下文运行环境，与主运行线程（执行脚本）相独立，同时也没有访问 DOM 的能力。</li> <li>service worker 现在可以处理事件了。</li> <li>受 service worker 控制的页面打开后会尝试去安装 service worker。最先发送给 service worker 的事件是安装事件(在这个事件里可以开始进行填充 IndexDB和缓存站点资源)。这个流程同原生 APP 或者 Firefox OS APP 是一样的 — 让所有资源可离线访问。</li> <li>当 <code>oninstall</code>事件的处理程序执行完毕后，可以认为 service worker 安装完成了。</li> <li>下一步是激活。当 service worker 安装完成后，会接收到一个激活事件(activate event)。 <code>onactivate</code>主要用途是清理先前版本的service worker 脚本中使用的资源。</li> <li>Service Worker 现在可以控制页面了，但仅是在 <code>register()</code>  成功后的打开的页面。也就是说，页面起始于有没有 service worker ，且在页面的接下来生命周期内维持这个状态。所以，页面不得不重新加载以让 service worker 获得完全的控制。</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1570366015992-156ac4e1-1428-4b83-a4b7-a5f4543d854d.png" alt="img"></p> <p>下图展示了 service worker 所有支持的事件：</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/388749/1570366018683-76df1e93-693e-4af5-b7a0-72ad0e30922a.png" alt="img"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/CICD.html" class="prev">CI/CD</a></span> <span class="next"><a href="/javascript/Docker.html">Docker</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4ed34284.js" defer></script><script src="/assets/js/2.179fc952.js" defer></script><script src="/assets/js/32.f57554e0.js" defer></script>
  </body>
</html>
